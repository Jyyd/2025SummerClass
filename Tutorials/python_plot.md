# ğŸ‰ Pythonæ•°æ®å¤„ç†ç¤ºä¾‹æ•™ç¨‹

æ¬¢è¿å¤§å®¶å‚åŠ  2025 å¹´ç§€é’Ÿæš‘æœŸå®è·µè¯¾ç¨‹ï¼ğŸŒ±

æœ¬æ•™ç¨‹ç”±è€å¸ˆå’ŒåŠ©æ•™å›¢é˜Ÿ ğŸ§‘â€ğŸ«ğŸ‘©â€ğŸ’» ç²¾å¿ƒç¼–å†™ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶é«˜æ•ˆå…¥é—¨æœ¬æ¬¡å®è·µæ‰€éœ€çš„ç¼–ç¨‹åŸºç¡€çŸ¥è¯†ã€‚æ— è®ºä½ æ˜¯åˆå­¦è€…è¿˜æ˜¯æœ‰ä¸€å®šç»éªŒï¼Œéƒ½å¯ä»¥é€šè¿‡æœ¬æ•™ç¨‹å¿«é€Ÿå®Œæˆä»£ç è°ƒè¯•å’Œæ•°æ®å¯è§†åŒ–å±•ç¤º ğŸ› ï¸ğŸ’¡ã€‚

è¯·å¤§å®¶æŒ‰ç…§æœ¬æ•™ç¨‹é€æ­¥æ“ä½œã€‚å¦‚æœåœ¨å­¦ä¹ æˆ–å®è·µè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶åœ¨ç­çº§ç¾¤æˆ–è¯¾ä¸Šå‘è€å¸ˆã€åŠ©æ•™æé—®ï¼Œæˆ‘ä»¬ä¼šåŠæ—¶ä¸ºå¤§å®¶è§£ç­”ä¸æ”¯æŒ ğŸ¤ã€‚

é¢„ç¥å¤§å®¶å®è·µå­¦ä¹ é¡ºåˆ©ï¼Œæ”¶è·æ»¡æ»¡ï¼ğŸš€âœ¨

> æŒ‡å¯¼è€å¸ˆ: å¼ å°ä¹ & åŠ©æ•™å›¢é˜Ÿ: è¹‡å§šå®‡è¶  
> 2025å¹´6æœˆ22æ—¥

# ä¼ æ„Ÿå™¨æ•°æ®åˆæˆã€å¯¼å‡ºä¸åŸºç¡€å¯è§†åŒ–æ•™ç¨‹

## 1. ä»£ç åŠŸèƒ½è¯´æ˜

æœ¬ç¤ºä¾‹ç”¨äºæ¼”ç¤ºå¦‚ä½•**è‡ªåŠ¨ç”Ÿæˆç¯å¢ƒä¼ æ„Ÿå™¨å®éªŒæ•°æ®**ï¼Œå¹¶å®Œæˆæ ‡å‡†æ ¼å¼çš„æ•°æ®å¯¼å‡ºä¸å¤šæ ·åŒ–å¯è§†åŒ–ã€‚é€‚ç”¨äºç‰©è”ç½‘ã€ç¯å¢ƒç›‘æµ‹ç­‰é¢†åŸŸçš„æ•°æ®æ•™å­¦ã€ç®—æ³•è°ƒè¯•ã€å±•ç¤ºå’Œå‰åç«¯æ¥å£ä»¿çœŸã€‚

### ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

- è‡ªåŠ¨ç”Ÿæˆ COâ‚‚ï¼ˆ350è‡³800ppmï¼‰ã€CHâ‚„ï¼ˆ0è‡³2000ppmï¼‰æ•°æ®
- æ„é€ ä»¿çœŸçš„ GPS å®šä½ç‚¹ï¼ˆåŒ—äº¬åŒºåŸŸå¾®æ‰°ï¼‰
- ä»¥æ ‡å‡†æ ¼å¼åˆæˆä¸º JSON/CSV ä¸¤ç§æ–‡ä»¶
- å¤šæ ·åŒ–å¯è§†åŒ–ï¼š
  - æµ“åº¦éšæ—¶é—´æŠ˜çº¿å›¾ï¼ˆå«åŸå§‹ä¸å¹³æ»‘ï¼‰
  - æ•°æ®åˆ†å¸ƒç›´æ–¹å›¾
  - åŒ Y è½´æµ“åº¦å¯¹æ¯”ï¼ˆä¾¿äºå¤šä¼ æ„Ÿå™¨å…³è”ï¼‰
  - å¯æ‰©å±•è‡³è½¨è¿¹çº¿åœ°å›¾ï¼ˆè¿›é˜¶åŠŸèƒ½ï¼‰

## 2. ä¸»è¦ä»£ç ç»“æ„

### 2.1 æ•°æ®ç”Ÿæˆä¸å¯¼å‡º

- åˆ©ç”¨ numpy éšæœºæ•°ç”Ÿæˆ COâ‚‚ã€CHâ‚„ æµ“åº¦æ•°æ®ï¼ŒGPS åæ ‡æ¨¡æ‹Ÿå°èŒƒå›´éšæœºæ¸¸èµ°
- æ‰€æœ‰æ•°æ®æŒ‰æ—¶é—´æˆ³å¯¹é½
- JSON æ–‡ä»¶ä¾¿äºæ¥å£å¼€å‘æˆ–ä»¿çœŸæ¨¡æ‹Ÿï¼ŒCSV æ–‡ä»¶ä¾¿äºåç»­åˆ†æå’Œå¯è§†åŒ–

### 2.2 æ•°æ®è¯»å–ä¸å¯è§†åŒ–

- é‡‡ç”¨ pandas è¯»å–ä¿å­˜çš„ CSV æ–‡ä»¶
- æ”¯æŒï¼š
  - CHâ‚„ã€COâ‚‚ æµ“åº¦éšæ—¶é—´å˜åŒ–æŠ˜çº¿å›¾
  - æ”¯æŒåŸºç¡€æ¸…æ´—ï¼ˆç¼ºå¤±å¡«è¡¥ã€å¼‚å¸¸å‰”é™¤ã€æ»‘åŠ¨å¹³å‡ï¼‰ï¼Œè‡ªåŠ¨ç¾åŒ–åæ ‡å’Œæ ‡ç­¾ã€‚
  - å››å®«æ ¼å­å›¾åŒ…æ‹¬ï¼šåŸå§‹æŠ˜çº¿ã€å¹³æ»‘æ›²çº¿ã€åˆ†å¸ƒç›´æ–¹å›¾ã€CHâ‚„/COâ‚‚ åŒ Y è½´æŠ˜çº¿ã€‚

## 3. ä½¿ç”¨æ–¹æ³•

1. **è¿è¡Œæ•°æ®ç”Ÿæˆè„šæœ¬**ï¼šè‡ªåŠ¨ä¿å­˜æ ‡å‡† JSON å’Œ CSV æ–‡ä»¶ã€‚
2. **è¿è¡Œæ•°æ®å¯è§†åŒ–è„šæœ¬**ï¼šè¯»å–ä¿å­˜çš„æ•°æ®æ–‡ä»¶ï¼Œç”Ÿæˆé«˜è´¨é‡æŠ˜çº¿ã€ç›´æ–¹ã€åŒè½´ç­‰å›¾è¡¨ã€‚

## 4. ç»“æœå±•ç¤º

- **CHâ‚„ã€COâ‚‚ æµ“åº¦æ—¶åºæ›²çº¿**ï¼šåŠ¨æ€å±•ç¤ºæ•°æ®æ³¢åŠ¨ä¸è¶‹åŠ¿ï¼Œå¹³æ»‘å¤„ç†ä¾¿äºè§‚æµ‹æ•´ä½“å˜åŒ–ã€‚
- **æ•°æ®åˆ†å¸ƒç›´æ–¹å›¾**ï¼šäº†è§£å„æ°”ä½“åœ¨æœ¬æ‰¹æ•°æ®ä¸­çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæœ‰åŠ©äºå‘ç°å¼‚å¸¸æˆ–è®¾è®¡åˆ†æ¡£ã€‚
- **åŒ Y è½´å¯¹æ¯”**ï¼šåŒæ­¥è§‚æµ‹ä¸åŒæ°”ä½“çš„å˜åŒ–åŒæ­¥æ€§ã€ç›¸å…³æ€§ã€‚

## 5. æ³¨æ„äº‹é¡¹ä¸æ‰©å±•å»ºè®®

- æ•°æ®å¯ç”¨äºç‰©è”ç½‘ç»ˆç«¯ä»¿çœŸã€è¾¹ç«¯ç®—æ³•è®­ç»ƒã€å‰ç«¯å¯è§†åŒ–å¼€å‘ç­‰å¤šåœºæ™¯ã€‚
- å¯æ‹“å±•ä¸ºå¤šè®¾å¤‡ã€å¤šæ°”ä½“ååŒä»¿çœŸï¼›æˆ–å¢åŠ çœŸå®é‡‡æ ·ç‚¹çš„æ•°æ®èåˆã€‚

## 6. å®Œæ•´ä»£ç 
### 6.1 å¦‚ä½•å†™ä¸€ä¸ªèƒ½ä¸Šä¼ çš„JSON/CSVæ–‡ä»¶å‘¢ï¼Ÿ
```python
# å¯¼å…¥éœ€è¦çš„åº“
import json
import numpy as np
from datetime import datetime, timedelta
import pandas as pd
from tqdm import trange

# è®¾ç½®æ—¶é—´æˆ³
timerange = 120 # æ—¶é—´èŒƒå›´ï¼š120ç§’
start_time = datetime(2025, 6, 23, 20, 2, 0) # èµ·å§‹æ—¶é—´ï¼š2025å¹´6æœˆ23æ—¥20ç‚¹0åˆ†0ç§’
timestamps = [start_time + timedelta(seconds=i) for i in range(timerange)] # ç”Ÿæˆ120ä¸ªè¿ç»­çš„æ—¶é—´æˆ³
timestamps_str = [t.strftime("%Y-%m-%d %H:%M:%S") for t in timestamps] # æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸ºå­—ç¬¦ä¸²

# è®¾å¤‡è¯†åˆ«å·ï¼Œè¿™é‡Œä¸€å®šè¦å’Œè®¾å¤‡çš„ä»£ç ä¸€æ ·
username = 'test1'
device_name = "esp32_001"
device_key = "abc123"

# æ„é€  CO, CH4 æ•°æ®ï¼ˆppmï¼‰
np.random.seed(0) # è®¾ç½®éšæœºç§å­ä»¥ç¡®ä¿ç»“æœå¯å¤ç°
co2_data = np.round(np.random.uniform(350, 800, timerange), 3).tolist() # ç”Ÿæˆ CO2 æ•°æ®ï¼Œ èŒƒå›´åœ¨ 350 åˆ° 800 ppm
ch4_data = np.round(np.random.uniform(0, 2000, timerange), 3).tolist() # ç”Ÿæˆ CH4 æ•°æ®ï¼Œ èŒƒå›´åœ¨ 0 åˆ° 2000 ppm

# æ„é€  GPS æ•°æ®ï¼ˆå›´ç»•æŸä¸€ç‚¹å¾®è°ƒï¼‰
lat_base, lon_base = 39.9042, 116.4074  # åŒ—äº¬æŸç‚¹
latitudes = (lat_base + np.random.normal(0, 0.0003, timerange)).round(6).tolist() # çº¬åº¦å¾®è°ƒ
longitudes = (lon_base + np.random.normal(0, 0.0003, timerange)).round(6).tolist() # ç»åº¦å¾®è°ƒ

# åˆå¹¶æ•°æ®ï¼šæ³¨æ„æ ¼å¼
combined_data_json = [] # åˆå§‹åŒ–åˆå¹¶æ•°æ®åˆ—è¡¨
combined_data_csv = [] # åˆå§‹åŒ–åˆå¹¶æ•°æ®åˆ—è¡¨ï¼Œç”¨äº CSV
for i in trange(timerange):
    combined_data_json.append({
        "username": username,
        "device_name": device_name,
        "device_key": device_key,
        "timestamp": timestamps_str[i],
        "lon": longitudes[i],
        "lat": latitudes[i],
        "data": {
            "CO2": co2_data[i],
            "CH4": ch4_data[i],
        },
    })
    combined_data_csv.append({
        "username": username,
        "device_name": device_name,
        "device_key": device_key,
        "timestamp": timestamps_str[i],
        "lon": longitudes[i],
        "lat": latitudes[i],
        "CO2": co2_data[i],
        "CH4": ch4_data[i],
    })


# # ä¿å­˜ä¸º JSON æ–‡ä»¶
# output_path = "./dataset/sensor_gps_combined.json" # ä¿å­˜çš„ç›¸å¯¹è·¯å¾„
# with open(output_path, "w") as f:
#     json.dump(combined_data_json, f, indent=2)

# æ„å»ºCSVæ ¼å¼çš„æ•°æ®ï¼Œå…ˆè½¬ä¸ºDataFrame
df = pd.DataFrame(combined_data_csv)
csv_output_path = "./dataset/sensor_gps_combined.csv" # ä¿å­˜çš„ç›¸å¯¹è·¯å¾„
df.to_csv(csv_output_path, index=False, encoding='utf-8-sig') # ä¿å­˜ä¸º CSV æ–‡ä»¶ï¼Œä½¿ç”¨ utf-8-sig ç¼–ç 
df
```
è¾“å‡ºæ ·ä¾‹ï¼š
```python
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 120/120 [00:00<?, ?it/s]
```
### 6.2 Pythonæ•°æ®å¯è§†åŒ–

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.dates import DateFormatter

# ä¿è¯ä¸­æ–‡å’Œè´Ÿå·æ­£å¸¸æ˜¾ç¤º
plt.rcParams['font.family'] = 'Arial' # è®¾ç½®å­—ä½“ä¸º Arial
plt.rcParams['font.size'] = 16 # è®¾ç½®å­—ä½“å¤§å°
plt.rcParams['axes.unicode_minus'] = False # ç¡®ä¿è´Ÿå·æ­£å¸¸æ˜¾ç¤º

# è¯»å–æ•°æ®
df = pd.read_csv('./dataset/sensor_gps_combined.csv', encoding='utf-8-sig')
df['timestamp'] = pd.to_datetime(df['timestamp'])

# ========== æ•°æ®æ¸…æ´—ä¸é¢„å¤„ç† ==========

# æ£€æŸ¥å’Œå¡«è¡¥ç¼ºå¤±å€¼
print(df.isnull().sum())
df['CH4'] = df['CH4'].interpolate() # ç®€å•çº¿æ€§æ’å€¼å¡«è¡¥ç¼ºå¤±
df['CO2'] = df['CO2'].interpolate()

# ç®€å•ç¦»ç¾¤å€¼å‰”é™¤ï¼ˆZ-score > 3 çš„æ•°æ®ç‚¹è®¾ä¸ºnanï¼‰
for gas in ['CH4', 'CO2']:
    z = (df[gas] - df[gas].mean()) / df[gas].std()
    df.loc[np.abs(z) > 3, gas] = np.nan
    df[gas] = df[gas].interpolate()

# è®¡ç®—æ»‘åŠ¨å¹³å‡ï¼ˆå¹³æ»‘æ›²çº¿ï¼‰
window = 10  # å¹³æ»‘çª—å£ï¼ˆç§’ï¼‰
df['CH4_smooth'] = df['CH4'].rolling(window, min_periods=1, center=True).mean()
df['CO2_smooth'] = df['CO2'].rolling(window, min_periods=1, center=True).mean()

# ========== 1. æ ‡å‡†æŠ˜çº¿+å¹³æ»‘çº¿ ==========
fig, ax = plt.subplots(figsize=(12, 5), dpi=300)
ax.plot(df['timestamp'], df['CH4'], color='grey', alpha=0.4, label=r'CH$_4$ Raw')
ax.plot(df['timestamp'], df['CO2'], color='lightblue', alpha=0.8, label=r'CO$_2$ Raw')
ax.plot(df['timestamp'], df['CH4_smooth'], color='crimson', linewidth=2, label=r'CH$_4$ (Smoothed)')
ax.plot(df['timestamp'], df['CO2_smooth'], color='navy', linewidth=2, label=r'CO$_2$ (Smoothed)')
ax.set_xlabel('Time') # è®¾ç½®Xè½´æ ‡ç­¾
ax.set_ylabel('Concentration (ppm)') # è®¾ç½®Yè½´æ ‡ç­¾
ax.legend(frameon=False, loc='upper right', ncol=2) # è®¾ç½®å›¾ä¾‹
ax.xaxis.set_major_formatter(DateFormatter('%H:%M:%S'))
ax.set_ylim(0, 2500)  # è®¾ç½®Yè½´èŒƒå›´
plt.tight_layout()
plt.show()

# ========== 2. å­å›¾å¸ƒå±€ï¼šåŸå§‹å€¼ã€å¹³æ»‘å€¼ã€ç›´æ–¹å›¾ ==========
fig, axs = plt.subplots(2, 2, figsize=(22, 10), dpi=300)
axs = axs.flatten()

# åŸå§‹æ›²çº¿
axs[0].plot(df['timestamp'], df['CH4'], label=r'CH$_4$', color='grey', alpha=0.5)
axs[0].plot(df['timestamp'], df['CO2'], label=r'CO$_2$', color='lightblue', alpha=0.9)
axs[0].legend(frameon=False, title='Raw Data')
axs[0].set_ylabel('Concentration (ppm)')
axs[0].set_xlabel('Time')
axs[0].set_ylim(0, 2500)
axs[0].xaxis.set_major_formatter(DateFormatter('%H:%M:%S'))

# å¹³æ»‘æ›²çº¿
axs[1].plot(df['timestamp'], df['CH4_smooth'], label=r'CH$_4$ (Smoothed)', color='crimson')
axs[1].plot(df['timestamp'], df['CO2_smooth'], label=r'CO$_2$ (Smoothed)', color='navy')
axs[1].legend(frameon=False, title='Smoothed Data')
axs[1].set_ylabel('Concentration (ppm)')
axs[1].set_xlabel('Time')
axs[1].set_ylim(0, 2000)
axs[1].xaxis.set_major_formatter(DateFormatter('%H:%M:%S'))

# ç›´æ–¹å›¾
axs[2].hist(
    df['CH4'], bins=20, color='crimson', alpha=0.5, 
    label=r'CH$_4$', edgecolor='white', linewidth=1.2
)
axs[2].hist(
    df['CO2'], bins=20, color='navy', alpha=0.5, 
    label=r'CO$_2$', edgecolor='white', linewidth=1.2
)
axs[2].legend(frameon=True, title='Histogram', title_fontsize=13)
axs[2].set_xlabel('Concentration (ppm)')
axs[2].set_ylabel('Frequency')
axs[2].grid(axis='y', linestyle='--', alpha=0.7)

# åŒYè½´æ›²çº¿
# ç¬¬4ä¸ªå­å›¾ï¼Œä½¿ç”¨åŒYè½´æ˜¾ç¤ºå¹³æ»‘æ›²çº¿
ax1 = axs[3]  # ç¬¬3ä¸ªå­å›¾
ax2 = ax1.twinx()
ax1.plot(df['timestamp'], df['CH4_smooth'], color='crimson', label=r'CH$_4$ (Smoothed)')
ax2.plot(df['timestamp'], df['CO2_smooth'], color='navy', label=r'CO$_2$ (Smoothed)')
ax1.set_ylabel(r'CH$_4$ Concentration (ppm)', color='crimson')
ax1.tick_params(axis='y', labelcolor='crimson')
ax2.tick_params(axis='y', labelcolor='navy')
ax2.set_ylabel(r'CO$_2$ Concentration (ppm)', color='navy')
ax1.set_xlabel('Time')
ax1.xaxis.set_major_formatter(DateFormatter('%H:%M:%S'))
ax1.set_ylim(500, 1500)  # è®¾ç½®CH4çš„Yè½´èŒƒå›´
ax2.set_ylim(400, 700)  # è®¾ç½®CO2çš„Yè½´èŒƒå›´

# å¯é€‰ï¼šåœ¨å­å›¾å³ä¸Šè§’å•ç‹¬åŠ å›¾ä¾‹ï¼ˆåŒYè½´æ—¶éœ€è¦æ‰‹åŠ¨åˆå¹¶legendï¼‰
lines, labels = [], []
for ax in [ax1, ax2]:
    for l in ax.get_lines():
        lines.append(l)
    for label in ax.get_legend_handles_labels()[1]:
        labels.append(label)
ax1.legend(lines, labels, loc='upper right', frameon=False, ncol=2)

plt.tight_layout()
plt.show()

```
æ•°æ®å¯è§†åŒ–æ ·ä¾‹ï¼š
![1](./figures/output1.png)

![2](./figures/output2.png)
---
### 6.3 Pythonæ•°æ®å¯è§†åŒ–æ›´æ–°
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.dates import DateFormatter
import matplotlib.dates as mdates
import matplotlib.ticker as ticker

# ä¿è¯è´Ÿå·æ­£å¸¸æ˜¾ç¤º
plt.rcParams['font.family'] = 'Arial' # è®¾ç½®å­—ä½“ä¸º Arial
plt.rcParams['font.size'] = 18 # è®¾ç½®å­—ä½“å¤§å°
plt.rcParams['axes.unicode_minus'] = False # ç¡®ä¿è´Ÿå·æ­£å¸¸æ˜¾ç¤º


# è¯»å–æ•°æ®
df = pd.read_csv('./device1.csv', encoding='utf-8-sig')
df['timestamp'] = pd.to_datetime(df['timestamp']) # å°†æ—¶é—´æˆ³åˆ—è½¬æ¢ä¸º datetime ç±»å‹
df = df[(df['value'] >= 0)] # è¿‡æ»¤æ‰è´Ÿå€¼æ•°æ®
df_co2 = df[(df['sensor_type'] == 'CO2 ')].copy() # æ³¨æ„ CO2 åæœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä½¿ç”¨ .copy() é¿å…è­¦å‘Š
df_ch4 = df[(df['sensor_type'] == 'CH4')].copy() # æ³¨æ„ CH4 åæ²¡æœ‰ç©ºæ ¼ï¼Œä½¿ç”¨ .copy() é¿å…è­¦å‘Š

# è®¡ç®—æ»‘åŠ¨å¹³å‡ï¼ˆå¹³æ»‘æ›²çº¿ï¼‰
window = 60  # å¹³æ»‘çª—å£ï¼ˆç§’ï¼‰
# rolling() æ–¹æ³•è®¡ç®—æ»‘åŠ¨å¹³å‡, window å‚æ•°æŒ‡å®šçª—å£å¤§å°ï¼Œmin_periods=1 ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªæ•°æ®ç‚¹æ—¶è®¡ç®—å¹³å‡å€¼ï¼Œcenter=True ä½¿å¾—å¹³å‡å€¼å±…ä¸­
df_co2['smooth'] = df_co2['value'].rolling(window, min_periods=10, center=True).mean()
df_ch4['smooth'] = df_ch4['value'].rolling(window, min_periods=10, center=True).mean()

# ç»˜åˆ¶ CO2 æ•°æ®å›¾
df_co2_plot = df_co2.copy() # å¤åˆ¶ CO2 æ•°æ®
df_co2_plot = df_co2_plot.sort_values(by='timestamp') # æŒ‰æ—¶é—´æˆ³æ’åº
df_co2_plot = df_co2_plot[(df_co2_plot['timestamp'] >= '2025-07-03 16:30:00') & (df_co2_plot['timestamp'] <= '2025-07-03 16:45:00')] # è¿‡æ»¤æ—¶é—´èŒƒå›´
fig, ax = plt.subplots(figsize=(15, 8), dpi=300)
ax.plot(df_co2_plot['timestamp'], df_co2_plot['value'],
        marker='o', linestyle='-', alpha=0.5,  # è®¾ç½®é€æ˜åº¦
        markersize=8,  # è®¾ç½®ç‚¹çš„å¤§å°
        color='green', label=r'CO$_2$ Raw Value')
ax.plot(df_co2_plot['timestamp'], df_co2_plot['smooth'],
        marker='<', linestyle='-', alpha=0.2,  # è®¾ç½®é€æ˜åº¦
        markersize=8,  # è®¾ç½®ç‚¹çš„å¤§å°
        color='b', label=r'CO$_2$ Smoothed Value')
ax.axvspan(pd.Timestamp('2025-07-03 16:32:40'), pd.Timestamp('2025-07-03 16:35:45'),
           color='red', alpha=0.1, label='Special Region 1')
ax.axvspan(pd.Timestamp('2025-07-03 16:39:21'), pd.Timestamp('2025-07-03 16:40:10'),
           color='purple', alpha=0.1, label='Special Region 2')
ax.axvspan(pd.Timestamp('2025-07-03 16:42:37'), pd.Timestamp('2025-07-03 16:43:10'),
           color='orange', alpha=0.1, label='Special Region 3')
ax.set_xlabel('Timestamp')
ax.set_ylabel('Concentration (ppm)')
ax.legend(frameon=False, loc='upper right', ncol=3, title='device1: 2025-07-03') # å›¾ä¾‹æ”¾åœ¨å³ä¸Šè§’
ax.xaxis.set_major_formatter(DateFormatter('%H:%M:%S')) # è®¾ç½® x è½´æ—¶é—´æ ¼å¼
ax.xaxis.set_major_locator(ticker.MaxNLocator(nbins=20, prune='both')) # è®¾ç½® x è½´åˆ»åº¦æ•°é‡
ax.set_ylim(0, 1200) # è®¾ç½® y è½´èŒƒå›´
plt.xticks(rotation=90) # æ·»åŠ  rotation=45 å¯ä»¥é¿å… x è½´æ ‡ç­¾é‡å 
plt.tight_layout() # è‡ªåŠ¨è°ƒæ•´å¸ƒå±€
plt.show() # æ˜¾ç¤ºå›¾åƒ


# ç»˜åˆ¶ CH4 æ•°æ®å›¾
df_ch4_plot = df_ch4.copy()
df_ch4_plot = df_ch4_plot.sort_values(by='timestamp') # æŒ‰æ—¶é—´æˆ³æ’åº
df_ch4_plot = df_ch4_plot[(df_ch4_plot['timestamp'] >= '2025-07-03 17:15:00') & (df_ch4_plot['timestamp'] <= '2025-07-03 17:30:00')] # è¿‡æ»¤æ—¶é—´èŒƒå›´
fig, ax = plt.subplots(figsize=(15, 6), dpi=300) # è®¾ç½®å›¾åƒå¤§å°å’Œåˆ†è¾¨ç‡
ax.plot(df_ch4_plot['timestamp'], df_ch4_plot['value'], marker='o',
        markersize=8,  # è®¾ç½®ç‚¹çš„å¤§å°
        linestyle='-', alpha=0.5, color='blue', label=r'CH$_4$ Raw Value') # ç»˜åˆ¶åŸå§‹æ•°æ®ç‚¹
ax.plot(df_ch4_plot['timestamp'], df_ch4_plot['smooth'], marker='*',
        markersize=8,  # è®¾ç½®ç‚¹çš„å¤§å°
        linestyle='-', alpha=0.2, color='purple', label=r'CH$_4$  Smoothed Value') # ç»˜åˆ¶å¹³æ»‘æ›²çº¿
ax.axvspan(pd.Timestamp('2025-07-03 17:18:56'), pd.Timestamp('2025-07-03 17:19:07'),
           color='red', alpha=0.1, label='Special Region 1') # ç»˜åˆ¶ç‰¹æ®ŠåŒºåŸŸ1
ax.axvspan(pd.Timestamp('2025-07-03 17:26:56'), pd.Timestamp('2025-07-03 17:27:16'),
           color='orange', alpha=0.1, label='Special Region 2') # ç»˜åˆ¶ç‰¹æ®ŠåŒºåŸŸ2
ax.set_xlabel('Timestamp')
ax.set_ylabel('Concentration (ppm)')
ax.legend(frameon=False, loc='upper left', ncol=2, title='device1: 2025-07-03',
          bbox_to_anchor=(0.2, 0.98))
ax.xaxis.set_major_formatter(DateFormatter('%H:%M:%S')) # è®¾ç½® x è½´æ—¶é—´æ ¼å¼
ax.xaxis.set_major_locator(ticker.MaxNLocator(nbins=20, prune='both')) # è®¾ç½® x è½´åˆ»åº¦æ•°é‡
ax.set_ylim(0, 12000) # è®¾ç½® y è½´èŒƒå›´
plt.xticks(rotation=90) # æ·»åŠ  rotation=45 å¯ä»¥é¿å… x è½´æ ‡ç­¾é‡å 
plt.tight_layout() # è‡ªåŠ¨è°ƒæ•´å¸ƒå±€
plt.show() # æ˜¾ç¤ºå›¾åƒ
```
![text](figures/output3.png) ![text](figures/output4.png)

å¦‚éœ€è¿›ä¸€æ­¥ç»˜å›¾é£æ ¼ç¾åŒ–ã€ç»Ÿè®¡åˆ†æã€è®¾å¤‡å¤šçº¿ç¨‹æ•°æ®ç”Ÿæˆç­‰è¿›é˜¶åŠŸèƒ½ï¼Œè¯·è‡ªè¡Œå­¦ä¹ ~
